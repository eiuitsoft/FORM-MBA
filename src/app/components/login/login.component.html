<div
  class="container-login100"
  style="background-image: url('assets/images/Login-Page-2023.png')">
  <div class="wrap-login100">
    <form class="login100-form validate-form" [formGroup]="loginForm">
      <span class="login100-form-logo">
        <img src="assets/images/logo-footer.png" class="thumb-fluid" alt="" />
      </span>
      
      <!-- Send OTP Form -->
      <div *ngIf="showFormSendOTP()">
        <div class="wrap-input100">
          <!-- Login Method Select -->
          <div class="form-group">
            <select formControlName="method"
                    (change)="changeLoginMethod($any($event.target).value)"
                    class="form-control">
              <option *ngFor="let item of loginMethods" [value]="item.value">
                {{ item.name }}
              </option>
            </select>
          </div>
          
          <!-- Value Input -->
          <div class="form-group">
            <label class="text-muted">
              {{
                loginForm.value.method == LoginMethodEnum.CCCD
                  ? 'Căn cước công dân'
                  : loginForm.value.method == LoginMethodEnum.CODE
                  ? 'Mã hồ sơ'
                  : 'Số điện thoại đã đăng ký'
              }}
            </label>
            <input
              formControlName="value"
              type="text"
              [placeholder]="
                loginForm.value.method == LoginMethodEnum.CCCD 
                  ? '284501234114' 
                  : loginForm.value.method == LoginMethodEnum.CODE
                  ? 'Nhập mã hồ sơ*'
                  : 'Nhập số điện thoại*'
              "
              class="form-control"
              [class.is-invalid]="loginForm.get('value')?.invalid && loginForm.get('value')?.touched" />
            <small *ngIf="loginForm.get('value')?.invalid && loginForm.get('value')?.touched" class="text-danger">
              {{ getFieldError('value') }}
            </small>
          </div>
        </div>
        
        <div class="container-login100-form-btn group-btn-get-otp mt-3">
          <button
            type="button"
            class="login100-form-btn mr-4"
            routerLink="/"
            [disabled]="isSendingOTP()">
            <svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            &nbsp;Quay lại
          </button>
          <button
            type="button"
            class="login100-form-btn"
            (click)="openModalChooseSendType()"
            [disabled]="isSendingOTP()">
            <svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
            </svg>
            &nbsp;Lấy mã OTP
          </button>
        </div>
      </div>
      
      <!-- OTP Input Form -->
      <div *ngIf="!showFormSendOTP()">
        <div class="wrap-input100">
          <div class="form-group">
            <label class="text-muted">OTP</label>
            <input
              formControlName="otp"
              type="text"
              placeholder="Nhập mã OTP"
              maxlength="6"
              (input)="isErrorOTP.set(false)"
              class="form-control otp-input"
              [class.is-invalid]="isErrorOTP()" />
            <small *ngIf="loginForm.get('otp')?.errors?.['maxlength']" class="text-danger">
              Mã OTP không được vượt quá 6 số.
            </small>
          </div>
          <div *ngIf="isErrorOTP()" class="error-icon-wrapper">
            <svg class="error-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>&nbsp;
            <small class="text-danger">Mã OTP không đúng hoặc đã hết hạn.</small>
          </div>
        </div>
        <div class="container-login100-form-btn mt-3">
          <div class="text-timer">
            <span>
              Hoặc gửi lại mã sau <span>{{ countdown() }}</span> giây.
              <span *ngIf="showResendButton()" (click)="openModalChooseSendType()" class="resend-link">Gửi lại</span>
            </span>
          </div>
          <button
            type="button"
            class="button-login"
            (click)="onLogin()"
            [disabled]="isSendingOTP()">
            {{ isSendingOTP() ? 'Đang xử lý...' : 'Đăng nhập' }}
          </button>
        </div>
      </div>

    </form>
  </div>

  <div class="wrap-login-support mt-3">
    <ul>
      <li>
        <b>Liên hệ hỗ trợ:</b><br />
        <small class="pl-2">Điện thoại: 0274 9999 681</small><br />
        <small class="pl-2">Hotline: 0918 907 733 - 0971 819 681 - 0969 845 681</small><br />
        <small class="pl-2">Email: tuyensinh@eiu.edu.vn</small><br />
        <div class="row mt-3">
          <div class="col text-center">
            <img
              src="assets/images/qrcode/qr_facebook_eiu.jpg"
              alt="Facebook QR"
              height="100px"
              width="100px"
              onerror="this.style.display='none'" />
            <br />
            <b class="pl-2">Facebook</b>
          </div>
          <div class="col text-center">
            <img
              src="assets/images/qrcode/qr_zalo_eiu.png"
              alt="Zalo QR"
              height="100px"
              width="100px"
              onerror="this.style.display='none'" />
            <br />
            <b class="pl-2">Zalo</b>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<!-- Modal Choose OTP Type -->
<div *ngIf="showModalChooseOTP()" 
     class="modal-backdrop"
     (click)="closeModal()">
  <div class="modal-content-wrapper" (click)="$event.stopPropagation()">
    
    <!-- Modal Header -->
    <div class="modal-header">
      <h5 class="modal-title">Chọn cách thức nhận mã OTP</h5>
      <button type="button" class="btn-close" (click)="closeModal()">
        <svg class="icon-svg-large" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <!-- Modal Body -->
    <div class="modal-body" [formGroup]="loginForm">
      <div class="radio-group">
        <label *ngFor="let item of sendOtpTypeList" 
               class="radio-label"
               [class.active]="loginForm.value.sendType === item.value">
          <input type="radio" 
                 formControlName="sendType" 
                 [value]="item.value">
          <span>{{ item.name }}</span>
        </label>
      </div>
      <b class="text-danger">⚠ Lưu ý :</b>
      <span>
        {{ sendOtpTypeMap[loginForm.value.sendType]?.message }}
      </span>
    </div>
    
    <!-- Modal Footer -->
    <div class="modal-footer">
      <button type="button" class="btn btn-primary button-login" (click)="sendOTP()" [disabled]="isSendingOTP()">
        <svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        &nbsp;{{ isSendingOTP() ? 'Đang gửi...' : 'Xác nhận' }}
      </button>
    </div>
  </div>
</div>
