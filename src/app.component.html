
<div class="min-h-screen p-4 sm:p-8 bg-slate-100 flex items-center justify-center">
  <div class="w-full max-w-5xl">

    <!-- Header -->
    <header class="text-center mb-10 animate-header">
      <div class="inline-flex items-start gap-4">
        <svg xmlns="http://www.w3.org/2000/svg"  class="h-12 w-12 text-[#153a5e] flex-shrink-0 -mt-1" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2L1 9l4 1.5V17h14v-6.5L23 9l-11-7zm-2 9h4v5h-4v-5zm-4 0h2v5H6v-5zm12 0h2v5h-2v-5zM3.5 18v2h17v-2H3.5z"/>
        </svg>
        <div>
          <h1 class="text-3xl sm:text-4xl font-bold text-[#153a5e] leading-none">EASTERN INTERNATIONAL UNIVERSITY</h1>
          <h2 class="text-xl sm:text-2xl font-semibold text-[#a68557] mt-1">MBA Application Form</h2>
        </div>
      </div>
    </header>

    <form [formGroup]="applicationForm" (ngSubmit)="submitForm()" class="space-y-8">

      <!-- Section A: Personal Details -->
      <section class="bg-white rounded-lg shadow-lg overflow-hidden form-section" formGroupName="personalDetails">
        <h3 class="px-6 py-4 bg-[#153a5e] text-xl font-bold text-white tracking-wider">SECTION A - PERSONAL DETAILS</h3>
        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
          <div class="md:col-span-2">
            <label for="fullName" class="block text-sm font-medium text-gray-700">Full name</label>
            <input type="text" id="fullName" formControlName="fullName" placeholder="Enter your full name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
            @if (personalDetails.get('fullName')?.hasError('required') && personalDetails.get('fullName')?.touched) {
              <p class="text-red-600 text-sm mt-1">Full name is required</p>
            }
            @if (personalDetails.get('fullName')?.hasError('minlength') && personalDetails.get('fullName')?.touched) {
              <p class="text-red-600 text-sm mt-1">Full name must be at least 2 characters</p>
            }
          </div>
          <div>
            <label for="nationalityId" class="block text-sm font-medium text-gray-700">Nationality</label>
            <select 
              id="nationalityId" 
              formControlName="nationalityId" 
              (change)="onNationalityChange($event)"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
              <option value="">-- Select nationality --</option>
              @for (country of countries(); track country.id) {
                <option [value]="country.id">{{ country.name }}</option>
              }
            </select>
            @if (personalDetails.get('nationalityId')?.hasError('required') && personalDetails.get('nationalityId')?.touched) {
              <p class="text-red-600 text-sm mt-1">Nationality is required</p>
            }
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Gender</label>
            <div class="mt-2 flex items-center space-x-6">
              <label class="inline-flex items-center"><input type="radio" formControlName="gender" value="Male" class="text-[#153a5e] focus:ring-[#a68557]"> <span class="ml-2">Male</span></label>
              <label class="inline-flex items-center"><input type="radio" formControlName="gender" value="Female" class="text-[#153a5e] focus:ring-[#a68557]"> <span class="ml-2">Female</span></label>
            </div>
          </div>
          <div>
            <label for="dateOfBirth" class="block text-sm font-medium text-gray-700">Date of birth (dd/mm/yyyy)</label>
            <input type="date" id="dateOfBirth" formControlName="dateOfBirth" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
            @if (personalDetails.get('dateOfBirth')?.hasError('required') && personalDetails.get('dateOfBirth')?.touched) {
              <p class="text-red-600 text-sm mt-1">Date of birth is required</p>
            }
            @if (personalDetails.get('dateOfBirth')?.hasError('minAge') && personalDetails.get('dateOfBirth')?.touched) {
              <p class="text-red-600 text-sm mt-1">You must be at least 18 years old</p>
            }
          </div>
          <div>
            <label for="placeOfBirth" class="block text-sm font-medium text-gray-700">Place of Birth</label>
            <input type="text" id="placeOfBirth" formControlName="placeOfBirth" placeholder="Enter place of birth" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
          </div>
          <div>
            <label for="passportNo" class="block text-sm font-medium text-gray-700">ID/ Passport No.</label>
            <div class="relative">
              <input 
                type="text" 
                id="passportNo" 
                formControlName="passportNo" 
                (input)="formatPassportInput($event)"
                placeholder="Enter ID or Passport number" 
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2 pr-10">
              @if (personalDetails.get('passportNo')?.pending) {
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <svg class="animate-spin h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </div>
              }
              @if (personalDetails.get('passportNo')?.valid && personalDetails.get('passportNo')?.touched && !personalDetails.get('passportNo')?.pending) {
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                </div>
              }
            </div>
            @if (personalDetails.get('passportNo')?.hasError('required') && personalDetails.get('passportNo')?.touched) {
              <p class="text-red-600 text-sm mt-1">ID/Passport is required</p>
            }
            @if (personalDetails.get('passportNo')?.hasError('invalidLength')) {
              <p class="text-red-600 text-sm mt-1">ID/Passport must be 6-12 characters</p>
            }
            @if (personalDetails.get('passportNo')?.hasError('invalidFormat')) {
              <p class="text-red-600 text-sm mt-1">ID/Passport can only contain letters and numbers</p>
            }
            @if (personalDetails.get('passportNo')?.hasError('passportExists') && personalDetails.get('passportNo')?.touched) {
              <p class="text-red-600 text-sm mt-1">This ID/Passport number is already registered</p>
            }
          </div>
          <div>
            <label for="dateIssued" class="block text-sm font-medium text-gray-700">Date Issued (dd/mm/yyyy)</label>
            <input type="date" id="dateIssued" formControlName="dateIssued" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
            <div class="relative">
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                (input)="formatEmailInput($event)"
                placeholder="example@domain.com" 
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2 pr-10">
              @if (personalDetails.get('email')?.valid && personalDetails.get('email')?.touched) {
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                </div>
              }
            </div>
            @if (personalDetails.get('email')?.hasError('required') && personalDetails.get('email')?.touched) {
              <p class="text-red-600 text-sm mt-1">Email is required</p>
            }
            @if ((personalDetails.get('email')?.hasError('email') || personalDetails.get('email')?.hasError('invalidEmailFormat')) && personalDetails.get('email')?.touched) {
              <p class="text-red-600 text-sm mt-1">Please enter a valid email address</p>
            }
            @if (personalDetails.get('email')?.hasError('invalidDomain') && personalDetails.get('email')?.touched) {
              <p class="text-red-600 text-sm mt-1">Email domain is invalid</p>
            }
          </div>
          <div>
            <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile</label>
            <ngx-intl-tel-input
              [cssClass]="'mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2'"
              [preferredCountries]="['vn', 'us', 'gb']"
              [enableAutoCountrySelect]="true"
              [enablePlaceholder]="true"
              [searchCountryFlag]="true"
              [searchCountryField]="['name', 'dialCode']"
              [selectFirstCountry]="false"
              [selectedCountryISO]="'vn'"
              [maxLength]="15"
              [phoneValidation]="true"
              [separateDialCode]="true"
              formControlName="mobile"
              id="mobile">
            </ngx-intl-tel-input>
            @if (personalDetails.get('mobile')?.pending) {
              <div class="flex items-center mt-1">
                <svg class="animate-spin h-4 w-4 text-gray-400 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-sm text-gray-500">Checking...</span>
              </div>
            }
            @if (personalDetails.get('mobile')?.valid && personalDetails.get('mobile')?.touched && !personalDetails.get('mobile')?.pending) {
              <div class="flex items-center mt-1">
                <svg class="h-4 w-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm text-green-600">Valid number</span>
              </div>
            }
            @if (personalDetails.get('mobile')?.hasError('validatePhoneNumber') && personalDetails.get('mobile')?.touched) {
              <p class="text-red-600 text-sm mt-1">Please enter a valid phone number</p>
            }
            @if (personalDetails.get('mobile')?.hasError('mobileExists') && personalDetails.get('mobile')?.touched) {
              <p class="text-red-600 text-sm mt-1">This mobile number is already registered</p>
            }
          </div>
          <div>
            <label for="jobTitle" class="block text-sm font-medium text-gray-700">Job title</label>
            <input type="text" id="jobTitle" formControlName="jobTitle" placeholder="Enter your job title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
          </div>
          <div>
            <label for="organization" class="block text-sm font-medium text-gray-700">Organization</label>
            <input type="text" id="organization" formControlName="organization" placeholder="Enter your organization" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
          </div>
          <div class="md:col-span-2">
            <label for="correspondenceAddress" class="block text-sm font-medium text-gray-700">Correspondence Address</label>
            <textarea id="correspondenceAddress" formControlName="correspondenceAddress" rows="2" placeholder="Enter your correspondence address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></textarea>
          </div>
          <div class="md:col-span-2">
            <label for="permanentAddress" class="block text-sm font-medium text-gray-700">Permanent Address</label>
            <textarea id="permanentAddress" formControlName="permanentAddress" rows="2" placeholder="Enter your permanent address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></textarea>
          </div>
        </div>
      </section>

      <!-- Section B: Application Details -->
      <section class="bg-white rounded-lg shadow-lg overflow-hidden form-section" formGroupName="applicationDetails">
        <h3 class="px-6 py-4 bg-[#153a5e] text-xl font-bold text-white tracking-wider">SECTION B - APPLICATION DETAILS</h3>
        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
          <div class="md:col-span-2">
            <label for="programId" class="block text-sm font-medium text-gray-700">Program name</label>
            <select 
              id="programId" 
              formControlName="programId" 
              (change)="onProgramChange($event)"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
              <option value="">-- Select a program --</option>
              @for (program of programs(); track program.id) {
                <option [value]="program.id">{{ program.name }}</option>
              }
            </select>
            @if (applicationDetails.get('programId')?.hasError('required') && (applicationDetails.get('programId')?.touched || submitted())) {
              <p class="text-red-600 text-sm mt-1">Please select a program</p>
            }
          </div>
          <div>
            <label for="programCode" class="block text-sm font-medium text-gray-700">Program code</label>
            <input type="text" id="programCode" formControlName="programCode" readonly class="mt-1 block w-full rounded-md border-gray-300 bg-gray-100 shadow-sm px-3 py-2 cursor-not-allowed">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Track</label>
            <div class="mt-2 flex items-center space-x-6">
                <label class="inline-flex items-center"><input type="radio" formControlName="track" value="Application" class="text-[#153a5e] focus:ring-[#a68557]"> <span class="ml-2">Application</span></label>
                <label class="inline-flex items-center"><input type="radio" formControlName="track" value="Research" class="text-[#153a5e] focus:ring-[#a68557]"> <span class="ml-2">Research</span></label>
            </div>
          </div>
          <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-x-6">
            <div>
              <label for="admissionYear" class="block text-sm font-medium text-gray-700">Admission Year</label>
              <input type="number" id="admissionYear" formControlName="admissionYear" placeholder="YYYY" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
              @if (applicationDetails.get('admissionYear')?.hasError('required') && applicationDetails.get('admissionYear')?.touched) {
                <p class="text-red-600 text-sm mt-1">Admission year is required</p>
              }
              @if (applicationDetails.get('admissionYear')?.hasError('minYear') && applicationDetails.get('admissionYear')?.touched) {
                <p class="text-red-600 text-sm mt-1">Admission year must be {{ currentYear }} or later</p>
              }
            </div>
            <div>
              <label for="admissionIntake" class="block text-sm font-medium text-gray-700">Admission Intake</label>
              <input type="text" id="admissionIntake" formControlName="admissionIntake" placeholder="Enter admission intake" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
              @if (applicationDetails.get('admissionIntake')?.hasError('required') && applicationDetails.get('admissionIntake')?.touched) {
                <p class="text-red-600 text-sm mt-1">Admission intake is required</p>
              }
            </div>
          </div>
        </div>
      </section>

      <!-- Section C: Previous Education -->
      <section class="bg-white rounded-lg shadow-lg overflow-hidden form-section" formGroupName="educationDetails">
        <h3 class="px-6 py-4 bg-[#153a5e] text-xl font-bold text-white tracking-wider">SECTION C - PREVIOUS EDUCATION DETAILS</h3>
        <div class="p-6 space-y-6">
          <!-- Undergraduate -->
          <div class="border border-gray-200 rounded-md p-4" formGroupName="undergraduate">
              <h4 class="font-semibold text-lg text-[#153a5e] mb-2">1. Undergraduate qualifications (First degree)</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700">University/ Institution</label>
                    <input type="text" formControlName="university" placeholder="Enter university or institution name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                    @if (educationDetails.get('undergraduate.university')?.hasError('required') && educationDetails.get('undergraduate.university')?.touched) {
                      <p class="text-red-600 text-sm mt-1">University/Institution is required</p>
                    }
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700">Country</label>
                    <select 
                      formControlName="countryId" 
                      (change)="onCountryChange($event, 'undergraduate')"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                      <option value="">-- Select country --</option>
                      @for (country of countries(); track country.id) {
                        <option [value]="country.id">{{ country.name }}</option>
                      }
                    </select>
                    @if (educationDetails.get('undergraduate.countryId')?.hasError('required') && educationDetails.get('undergraduate.countryId')?.touched) {
                      <p class="text-red-600 text-sm mt-1">Country is required</p>
                    }
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700">Major</label>
                    <input type="text" formControlName="major" placeholder="Enter your major" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                    @if (educationDetails.get('undergraduate.major')?.hasError('required') && educationDetails.get('undergraduate.major')?.touched) {
                      <p class="text-red-600 text-sm mt-1">Major is required</p>
                    }
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700">Year of graduation</label>
                    <input type="number" formControlName="graduationYear" placeholder="YYYY" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                    @if (educationDetails.get('undergraduate.graduationYear')?.hasError('required') && educationDetails.get('undergraduate.graduationYear')?.touched) {
                      <p class="text-red-600 text-sm mt-1">Year of graduation is required</p>
                    }
                    @if (educationDetails.get('undergraduate.graduationYear')?.hasError('maxYear') && educationDetails.get('undergraduate.graduationYear')?.touched) {
                      <p class="text-red-600 text-sm mt-1">Year of graduation cannot be in the future</p>
                    }
                  </div>
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Language of instruction</label>
                    <select 
                      formControlName="languageId" 
                      (change)="onLanguageChange($event, 'undergraduate')"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                      <option value="">-- Select language --</option>
                      @for (language of languages(); track language.id) {
                        <option [value]="language.id">{{ language.name }}</option>
                      }
                    </select>
                    @if (educationDetails.get('undergraduate.languageId')?.hasError('required') && educationDetails.get('undergraduate.languageId')?.touched) {
                      <p class="text-red-600 text-sm mt-1">Language of instruction is required</p>
                    }
                  </div>
              </div>
          </div>
           <!-- Second Degree -->
          <div class="border border-gray-200 rounded-md p-4" formGroupName="secondDegree">
              <h4 class="font-semibold text-lg text-[#153a5e] mb-2">Second degree (if any)</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                  <!-- ... same fields as undergraduate ... -->
                  <div><label class="block text-sm font-medium text-gray-700">University/ Institution</label><input type="text" formControlName="university" placeholder="Enter university or institution name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700">Country</label>
                    <select 
                      formControlName="countryId" 
                      (change)="onCountryChange($event, 'secondDegree')"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                      <option value="">-- Select country --</option>
                      @for (country of countries(); track country.id) {
                        <option [value]="country.id">{{ country.name }}</option>
                      }
                    </select>
                  </div>
                  <div><label class="block text-sm font-medium text-gray-700">Major</label><input type="text" formControlName="major" placeholder="Enter your major" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div><label class="block text-sm font-medium text-gray-700">Year of graduation</label><input type="number" placeholder="YYYY" formControlName="graduationYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Language of instruction</label>
                    <select 
                      formControlName="languageId" 
                      (change)="onLanguageChange($event, 'secondDegree')"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                      <option value="">-- Select language --</option>
                      @for (language of languages(); track language.id) {
                        <option [value]="language.id">{{ language.name }}</option>
                      }
                    </select>
                  </div>
              </div>
          </div>
          <!-- Postgraduate -->
          <div class="border border-gray-200 rounded-md p-4" formGroupName="postgraduate">
              <h4 class="font-semibold text-lg text-[#153a5e] mb-2">2. Postgraduate qualifications (if any)</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                  <!-- ... same fields as undergraduate plus Thesis title ... -->
                  <div><label class="block text-sm font-medium text-gray-700">University/ Institution</label><input type="text" formControlName="university" placeholder="Enter university or institution name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700">Country</label>
                    <select 
                      formControlName="countryId" 
                      (change)="onCountryChange($event, 'postgraduate')"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                      <option value="">-- Select country --</option>
                      @for (country of countries(); track country.id) {
                        <option [value]="country.id">{{ country.name }}</option>
                      }
                    </select>
                  </div>
                  <div><label class="block text-sm font-medium text-gray-700">Major</label><input type="text" formControlName="major" placeholder="Enter your major" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div><label class="block text-sm font-medium text-gray-700">Year of graduation</label><input type="number" placeholder="YYYY" formControlName="graduationYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700">Thesis title</label><input type="text" formControlName="thesisTitle" placeholder="Enter thesis title (if applicable)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Language of instruction</label>
                    <select 
                      formControlName="languageId" 
                      (change)="onLanguageChange($event, 'postgraduate')"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                      <option value="">-- Select language --</option>
                      @for (language of languages(); track language.id) {
                        <option [value]="language.id">{{ language.name }}</option>
                      }
                    </select>
                  </div>
              </div>
          </div>
        </div>
      </section>

      <!-- Section: English Qualifications -->
      <section class="bg-white rounded-lg shadow-lg overflow-hidden form-section" formGroupName="englishQualifications">
        <h3 class="px-6 py-4 bg-[#153a5e] text-xl font-bold text-white tracking-wider">3. English qualifications</h3>
        <div class="p-6 space-y-6">
            <!-- IELTS -->
            <div formGroupName="ielts">
              <div class="grid grid-cols-5 gap-x-6 items-start">
                <label class="col-span-1 ml-3 font-semibold text-gray-700 pt-2">IELTS</label>
                <div class="col-span-2">
                  <input type="text" formControlName="score" placeholder="Score (0-9)" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                  @if (englishQualifications.get('ielts.score')?.hasError('required') && englishQualifications.get('ielts.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Score is required when date is provided</p>
                  }
                  @if (englishQualifications.get('ielts.score')?.hasError('scoreRange') && englishQualifications.get('ielts.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">IELTS score must be between 0 and 9</p>
                  }
                  @if (englishQualifications.get('ielts.score')?.hasError('invalidScore') && englishQualifications.get('ielts.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Please enter a valid number</p>
                  }
                </div>
                <div class="col-span-2">
                  <input type="date" formControlName="date" placeholder="Date of Test" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                  @if (englishQualifications.get('ielts.date')?.hasError('required') && englishQualifications.get('ielts.date')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Date is required when score is provided</p>
                  }
                  @if (englishQualifications.get('ielts.date')?.hasError('maxDate') && englishQualifications.get('ielts.date')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Date cannot be in the future</p>
                  }
                </div>
              </div>
            </div>

            <!-- TOEFL -->
            <div formGroupName="toefl">
              <div class="grid grid-cols-5 gap-x-6 items-start">
                <label class="col-span-1 ml-3 font-semibold text-gray-700 pt-2">TOEFL</label>
                <div class="col-span-2">
                  <input type="text" formControlName="score" placeholder="Score (0-120)" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                  @if (englishQualifications.get('toefl.score')?.hasError('required') && englishQualifications.get('toefl.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Score is required when date is provided</p>
                  }
                  @if (englishQualifications.get('toefl.score')?.hasError('scoreRange') && englishQualifications.get('toefl.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">TOEFL score must be between 0 and 120</p>
                  }
                  @if (englishQualifications.get('toefl.score')?.hasError('invalidScore') && englishQualifications.get('toefl.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Please enter a valid number</p>
                  }
                </div>
                <div class="col-span-2">
                  <input type="date" formControlName="date" placeholder="Date of Test" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                  @if (englishQualifications.get('toefl.date')?.hasError('required') && englishQualifications.get('toefl.date')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Date is required when score is provided</p>
                  }
                  @if (englishQualifications.get('toefl.date')?.hasError('maxDate') && englishQualifications.get('toefl.date')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Date cannot be in the future</p>
                  }
                </div>
              </div>
            </div>

            <!-- Other Test -->
            <div formGroupName="other">
              <div class="grid grid-cols-5 gap-x-6 items-start">
                <div class="col-span-1">
                  <input type="text" formControlName="name" placeholder="Other Test" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                </div>
                <div class="col-span-2">
                  <input type="text" formControlName="score" placeholder="Score" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                  @if (englishQualifications.get('other.score')?.hasError('required') && englishQualifications.get('other.score')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Score is required when date is provided</p>
                  }
                </div>
                <div class="col-span-2">
                  <input type="date" formControlName="date" placeholder="Date of Test" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                  @if (englishQualifications.get('other.date')?.hasError('required') && englishQualifications.get('other.date')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Date is required when score is provided</p>
                  }
                  @if (englishQualifications.get('other.date')?.hasError('maxDate') && englishQualifications.get('other.date')?.touched) {
                    <p class="text-red-600 text-xs mt-1">Date cannot be in the future</p>
                  }
                </div>
              </div>
            </div>
            
            <!-- Validation message for at least one English qualification -->
            @if (englishQualifications.hasError('atLeastOneRequired') && (submitted() || englishQualifications.touched)) {
              <div class="mt-4 p-3 bg-red-50 border border-red-200 rounded-md">
                <p class="text-red-600 text-sm">Please provide at least one English qualification (IELTS, TOEFL or Other)</p>
              </div>
            }
        </div>
      </section>

      <!-- Section D: Employment History -->
      <section class="bg-white rounded-lg shadow-lg overflow-hidden form-section" formGroupName="employmentHistory">
        <h3 class="px-6 py-4 bg-[#153a5e] text-xl font-bold text-white tracking-wider">SECTION D - EMPLOYMENT HISTORY</h3>
        <div class="p-6 space-y-6">
          <div class="border border-gray-200 rounded-md p-4" formGroupName="position1">
            <h4 class="font-semibold text-lg text-[#153a5e] mb-2">Position 1 (Most recent)</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
              <div><label class="block text-sm font-medium text-gray-700">Organization</label><input type="text" formControlName="organization" placeholder="Enter organization name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
              <div><label class="block text-sm font-medium text-gray-700">Position/ Title</label><input type="text" formControlName="title" placeholder="Enter your position or title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
              <div><label class="block text-sm font-medium text-gray-700">From (mm/yyyy)</label><input type="month" formControlName="from" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
              <div>
                <label class="block text-sm font-medium text-gray-700">To (mm/yyyy)</label>
                <input type="month" formControlName="to" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                @if (employmentHistory.get('position1')?.hasError('dateRange') && employmentHistory.get('position1.to')?.touched) {
                  <p class="text-red-600 text-sm mt-1">End date must be after or equal to start date</p>
                }
              </div>
              <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700">Organization address</label><textarea formControlName="address" rows="2" placeholder="Enter organization address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></textarea></div>
            </div>
          </div>
          <div class="border border-gray-200 rounded-md p-4" formGroupName="position2">
            <h4 class="font-semibold text-lg text-[#153a5e] mb-2">Position 2 (if applicable)</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
              <div><label class="block text-sm font-medium text-gray-700">Organization</label><input type="text" formControlName="organization" placeholder="Enter organization name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
              <div><label class="block text-sm font-medium text-gray-700">Position/ Title</label><input type="text" formControlName="title" placeholder="Enter your position or title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
              <div><label class="block text-sm font-medium text-gray-700">From (mm/yyyy)</label><input type="month" formControlName="from" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></div>
              <div>
                <label class="block text-sm font-medium text-gray-700">To (mm/yyyy)</label>
                <input type="month" formControlName="to" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2">
                @if (employmentHistory.get('position2')?.hasError('dateRange') && employmentHistory.get('position2.to')?.touched) {
                  <p class="text-red-600 text-sm mt-1">End date must be after or equal to start date</p>
                }
              </div>
              <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700">Organization address</label><textarea formControlName="address" rows="2" placeholder="Enter organization address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#a68557] focus:ring-[#a68557] px-3 py-2"></textarea></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Section E: Declaration -->
      <section class="bg-white rounded-lg shadow-lg overflow-hidden form-section" formGroupName="declaration">
        <h3 class="px-6 py-4 bg-[#153a5e] text-xl font-bold text-white tracking-wider">SECTION E - DECLARATION</h3>
        <div class="p-6 space-y-4 text-gray-700">
          <p>By applying for admission to the Master of Business Administration program at Eastern International University, I hereby commit to fulfilling all academic, research, and financial obligations upon admission as follows:</p>
          <ol class="list-decimal list-inside space-y-2 pl-4">
            <li>Comply with all training regulations and policies of Eastern International University;</li>
            <li>Ensure adequate time for studying and conducting research; participate in academic activities; and strictly follow the university study and research plan;</li>
            <li>Pay tuition fees and any other required fees in accordance with university regulations;</li>
            <li>Provide consent for Eastern International University to use and verify my certificates and academic qualifications.</li>
          </ol>
          <p class="font-semibold">I hereby declare that all information provided in this Application Form is true and accurate and shall take full responsibility for any false declarations.</p>
          <div class="pt-4">
            <label class="inline-flex items-center text-lg">
              <input type="checkbox" formControlName="agreed" class="h-5 w-5 rounded border-gray-300 text-[#153a5e] focus:ring-[#a68557]">
              <span class="ml-3">I agree to the terms and conditions.</span>
            </label>
          </div>
        </div>
      </section>

      <!-- Submission -->
      <div class="text-center pt-4 form-section">
        <button type="submit" [disabled]="!applicationForm.get('declaration.agreed')?.value" class="w-full max-w-xs inline-flex justify-center py-3 px-6 border border-transparent shadow-lg text-lg font-bold rounded-md text-white bg-[#153a5e] hover:bg-[#a68557] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#a68557] transition-all duration-300 transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:bg-gray-400">
          Submit Application
        </button>
        @if (submitted() && applicationForm.invalid) {
          <p class="mt-4 text-red-600">Please review the form and fill in all required fields marked with an asterisk or highlighted in red.</p>
        }
      </div>
    </form>
  </div>

  <!-- Dialog -->
  @if (showDialog()) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fadeIn" (click)="closeDialog()">
      <div class="bg-white rounded-lg shadow-2xl max-w-md w-full p-6 transform transition-all animate-slideUp" (click)="$event.stopPropagation()">
        <div class="flex items-start mb-4">
          @if (dialogType() === 'success') {
            <div class="flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
          } @else {
            <div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
              <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </div>
          }
          <div class="ml-4 flex-1">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">
              {{ dialogType() === 'success' ? 'Success' : 'Error' }}
            </h3>
            <p class="text-gray-600">{{ dialogMessage() }}</p>
          </div>
        </div>
        <div class="flex justify-end mt-6">
          <button (click)="closeDialog()" class="px-6 py-2 bg-[#153a5e] text-white rounded-md hover:bg-[#a68557] transition-colors duration-200 font-medium">
            Close
          </button>
        </div>
      </div>
    </div>
  }
</div>
